---
permalink: /DoD_Login_Style.html
---
<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>MH&AS Studios™ | Operative Access</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/fontawesome-all.min.css" />
		<link rel="icon" type="image/x-icon" href="images/Logo_1.png">
		
		<style>
			/* ==========================================================================
			   THEME: TACTICAL OPS (VIDEO BACKDROP)
			   ========================================================================== */
			:root {
				--mh-blue: #0080FF;
				--mh-cyan: #00e5ff;
				--mh-dark: #05070a;
				--mh-glass: rgba(13, 17, 23, 0.9);
				--mh-red: #ff004c;
				--mh-green: #00ff41;
			}

			body {
				margin: 0;
				padding: 0;
				background-color: #000;
				color: #fff;
				font-family: 'Uni Sans', sans-serif;
				height: 100vh;
				overflow: hidden;
				display: flex;
				justify-content: center;
				align-items: center;
			}

			/* --- GLOBAL SCROLLBAR THEME (Requested Blue/Cyan) --- */
			::-webkit-scrollbar {
				width: 6px;
			}
			::-webkit-scrollbar-track {
				background: rgba(0, 0, 0, 0.3);
			}
			::-webkit-scrollbar-thumb {
				background: var(--mh-blue);
				border-radius: 3px;
			}
			::-webkit-scrollbar-thumb:hover {
				background: var(--mh-cyan);
			}

			/* --- 1. BACKGROUND LAYERS --- */
			#video-layer {
				position: fixed; top: 0; left: 0; width: 100%; height: 100%;
				z-index: -2;
				object-fit: cover;
				opacity: 0.6;
			}

			#mesh-layer {
				position: fixed; top: 0; left: 0; width: 100%; height: 100%;
				z-index: -1;
				background-image: 
					linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
					linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(255, 0, 0, 0.02));
				background-size: 100% 2px, 3px 100%;
				pointer-events: none;
			}
			
			/* --- UI VISIBILITY CONTROL --- */
			.login-container { display: none; }

			#page-loader {
				position: fixed; top: 0; left: 0; width: 100%; height: 100%;
				background: #000; z-index: 9999;
				display: flex; justify-content: center; align-items: center;
			}
			
			/* --- 2. MAIN INTERFACE CONTAINER --- */
			.secure-interface {
				display: flex;
				width: 900px;
				max-width: 95%;
				height: 600px; 
				background: var(--mh-glass);
				border: 1px solid rgba(255,255,255,0.1);
				backdrop-filter: blur(15px);
				box-shadow: 0 0 80px rgba(0,0,0,0.8);
				border-radius: 4px;
				overflow: hidden;
				animation: bootUp 1s ease-out;
				transition: border-color 0.3s;
			}

			/* --- 3. LEFT PANEL (INTEL) --- */
			.intel-panel {
				width: 40%;
				background: rgba(0,0,0,0.4);
				border-right: 1px solid rgba(255,255,255,0.1);
				padding: 40px;
				display: flex;
				flex-direction: column;
				justify-content: space-between;
				position: relative;
			}
			
			.brand-lockup { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
			.brand-lockup img { height: 40px; filter: drop-shadow(0 0 8px var(--mh-blue)); }
			.brand-text { font-size: 1.2em; letter-spacing: 2px; color: #fff; font-weight: 400; }

			.sys-info {
				font-family: 'Courier New', monospace;
				font-size: 0.75em;
				color: #888;
				line-height: 1.6;
			}
			.sys-row { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.05); padding: 5px 0; }
			.sys-val { color: var(--mh-cyan); }

			.encryption-visual {
				height: 100px;
				background: rgba(0,0,0,0.3);
				border: 1px solid #333;
				margin-top: 20px;
				position: relative;
				overflow: hidden;
			}
			.code-stream {
				position: absolute; top: 0; left: 0;
				font-family: 'Courier New', monospace; font-size: 10px; color: var(--mh-blue); opacity: 0.5;
				padding: 10px;
				animation: scrollCode 5s linear infinite;
			}

			/* --- 4. RIGHT PANEL (ACCESS FORM) --- */
			.access-panel {
				width: 60%;
				padding: 40px;
				position: relative;
				display: flex;
				flex-direction: column;
				overflow-y: auto;
				height: 100%;
			}

			.panel-header { text-align: center; margin-bottom: 30px; flex-shrink: 0; }
			.panel-title { font-size: 1.8em; font-weight: 900; letter-spacing: 3px; color: #fff; margin-bottom: 5px; }
			.panel-sub { font-family: 'Courier New', monospace; font-size: 0.7em; color: var(--mh-blue); }

			/* TABS */
			.auth-toggle {
				display: flex;
				background: rgba(0,0,0,0.3);
				border-radius: 4px;
				padding: 5px;
				margin-bottom: 30px;
				flex-shrink: 0;
			}
			.toggle-btn {
				flex: 1; text-align: center; padding: 10px; font-size: 0.8em;
				cursor: pointer; transition: 0.3s; color: #666; border-radius: 2px; font-weight: bold;
			}
			.toggle-btn.active {
				background: var(--mh-blue); color: #000; box-shadow: 0 0 15px rgba(0,128,255,0.3);
			}

			/* INPUTS (Updated for Visibility) */
			.input-frame { position: relative; margin-bottom: 20px; }
			.input-frame label {
				display: block; font-family: 'Courier New', monospace; font-size: 0.7em; color: #aaa; margin-bottom: 8px;
			}
			
			.tac-input {
				width: 100%;
				background: rgba(255,255,255,0.05);
				border: 1px solid rgba(255,255,255,0.1);
				color: #fff; /* White Text Default */
				padding: 12px 15px;
				outline: none;
				transition: 0.3s;
				font-family: sans-serif;
			}
			
			/* FOCUS STATE: Glows Cyan & Text turns Cyan */
			.tac-input:focus {
				border-color: var(--mh-cyan);
				color: var(--mh-cyan); 
				background: rgba(0, 229, 255, 0.05);
				box-shadow: 0 0 10px rgba(0, 229, 255, 0.1);
			}

			/* FIX FOR CHROME AUTOFILL (Prevents black text on dark background) */
			input:-webkit-autofill,
			input:-webkit-autofill:hover, 
			input:-webkit-autofill:focus, 
			input:-webkit-autofill:active {
				-webkit-text-fill-color: var(--mh-cyan) !important;
				-webkit-box-shadow: 0 0 0px 1000px #05070a inset;
				transition: background-color 5000s ease-in-out 0s;
			}

			/* BUTTON */
			.execute-btn {
				width: 100%;
				background: transparent;
				border: 1px solid var(--mh-cyan);
				color: var(--mh-cyan);
				padding: 15px;
				font-weight: 900;
				letter-spacing: 2px;
				cursor: pointer;
				text-transform: uppercase;
				transition: 0.3s;
				margin-top: 10px;
				position: relative;
				overflow: hidden;
			}
			.execute-btn:hover {
				background: var(--mh-cyan);
				color: #000;
				box-shadow: 0 0 30px var(--mh-cyan);
			}

			/* OAUTH & EXTRAS */
			.oauth-divider {
				display: flex; align-items: center; text-align: center; margin: 25px 0 15px 0; color: #555; font-size: 0.65em; letter-spacing: 1px;
			}
			.oauth-divider::before, .oauth-divider::after { content: ''; flex: 1; border-bottom: 1px solid #333; }
			.oauth-divider span { padding: 0 10px; }

			.oauth-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
			.oauth-btn {
				background: rgba(255,255,255,0.03); border: 1px solid #333; padding: 12px;
				color: #aaa; font-size: 1.1em; cursor: pointer; transition: 0.3s; display: flex; justify-content: center; align-items: center;
			}
			.oauth-btn:hover { border-color: var(--mh-blue); color: var(--mh-blue); background: rgba(0,128,255,0.05); }

			.forgot-link {
				display: inline-block; font-size: 0.7em; color: #666; text-decoration: none; margin-top: 10px; cursor: pointer; transition: 0.3s;
			}
			.forgot-link:hover { color: var(--mh-cyan); text-decoration: underline; }

			/* ROLE CARDS */
			.role-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
			.role-card {
				background: rgba(0,0,0,0.3); border: 1px solid #333; padding: 15px; text-align: center; cursor: pointer; transition: 0.3s;
			}
			.role-card:hover { border-color: #666; }
			.role-card.selected { border-color: var(--mh-blue); background: rgba(0,128,255,0.1); }
			.role-icon { font-size: 1.5em; color: #888; margin-bottom: 5px; }
			.role-card.selected .role-icon { color: var(--mh-blue); }
			.role-label { font-size: 0.7em; font-weight: bold; color: #fff; }

			/* UTILS */
			.hidden { display: none; }
			.status-log { 
				margin-top: 20px; font-family: 'Courier New', monospace; font-size: 0.75em; text-align: center; min-height: 20px; flex-shrink: 0;
			}
			.home-link {
				margin-top: 30px; margin-bottom: 10px; text-align: center; display: block;
				font-size: 0.7em; color: #555; text-decoration: none; flex-shrink: 0;
			}
			.home-link:hover { color: var(--mh-cyan); }

			@keyframes bootUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
			@keyframes scrollCode { 0% { transform: translateY(0); } 100% { transform: translateY(-100%); } }

			/* ==========================================================================
			   RESPONSIVE DESIGN (Tecno Spark 6 Go / 721px Ceiling)
			   ========================================================================== */
			@media screen and (max-width: 721px) {
				
				/* MAIN CONTAINER: The 'Window' that holds everything */
				.secure-interface {
					flex-direction: column; /* Stack top-to-bottom */
					
					/* Dimensions */
					width: 96%;
					max-width: 500px;
					
					/* KEY FIX: Make the WHOLE box scrollable */
					height: auto;
					max-height: 90vh;       
					overflow-y: auto;       /* This enables the Blue Scrollbar */
					
					margin: 0 auto;         
					padding: 0;
				}

				/* LEFT PANEL (Logo) - Now it scrolls with the page */
				.intel-panel {
					width: 100%;
					min-height: auto;       
					padding: 15px;
					border-right: none;
					border-bottom: 1px solid rgba(255,255,255,0.1);
					
					/* Layout */
					display: flex;
					flex-direction: row;
					align-items: center;
					justify-content: center;
					gap: 15px;
					flex-shrink: 0;         
				}

				/* LOGO RESIZING (Fixed Selector) */
				.brand-lockup {
					margin: 0;
					gap: 10px;
				}
				.brand-lockup img {
					height: 30px;           /* Smaller logo for mobile */
					width: auto;
				}
				.brand-text {
					font-size: 1rem;        
				}

				/* FORM PANEL - Natural Flow */
				.access-panel {
					width: 100%;
					height: auto;           
					overflow: visible;      /* No internal scroll */
					padding: 3.5rem;          
				}

				/* INPUTS - Big and Easy to Tap */
				.tac-input {
					width: 100%;
					box-sizing: border-box; 
					font-size: 16px;        /* Prevents zoom */
					padding: 15px;
					height: 50px;
				}

				/* BUTTONS */
				.execute-btn {
					width: 100%;
					padding: 15px;
					font-size: 1rem;
				}

				/* Hide extra visuals on mobile */
				.encryption-visual, 
				.sys-info {
					display: none; 
				}
				
				/* --- PASSWORD EYE STYLES --- */
				.password-wrapper {
					position: relative;
					width: 100%;
				}
				.password-toggle {
					position: absolute;
					right: 15px;
					top: 50%;
					transform: translateY(-50%);
					cursor: pointer;
					color: var(--mh-blue);
					z-index: 10;
					transition: 0.3s;
				}
				.password-toggle:hover {
					color: #fff;
					text-shadow: 0 0 10px var(--mh-blue);
				}
			}

			/* KEYBOARD FIX: When screen gets short */
			@media screen and (max-height: 600px) {
				.secure-interface {
					max-height: 100vh;      
					border: none;
					border-radius: 0;
				}
				.intel-panel {
					padding: 10px;          
				}
				.access-panel {
					padding: 1.5rem;        
				}
			}
		</style>
	</head>
	<body>
	
		<div id="page-loader">
			<div style="text-align:center;">
				<div class="spinner"></div> <p style="font-family:'Courier New'; color:var(--mh-cyan); letter-spacing:2px;">
					ESTABLISHING SECURE CONNECTION...
				</p>
			</div>
		</div>

		<video autoplay muted loop id="video-layer">
			<source src="videos/DoD_BGV.mp4" type="video/mp4">
		</video>
		<div id="mesh-layer"></div>
		
	<div class="login-container">
		<div class="secure-interface">
			
			<div class="intel-panel">
				<div>
					<div class="brand-lockup">
						<a href="index.html" class="brand-link">
							<img src="images/Logo_1.png" alt="MH LOGO">
							MH&AS STUDIOS™
						</a>
					</div>
					<div class="sys-info">
						<div class="sys-row"><span>NODE_ID:</span> <span class="sys-val">ALPHA-7</span></div>
						<div class="sys-row"><span>STATUS:</span> <span class="sys-val" style="color:var(--mh-green);">ONLINE</span></div>
						<div class="sys-row"><span>ENCRYPTION:</span> <span class="sys-val">TLS 1.3</span></div>
						<div class="sys-row"><span>LATENCY:</span> <span class="sys-val">12ms</span></div>
					</div>
				</div>
				
				<div class="encryption-visual">
					<div class="code-stream">
						01010101 MH_PROTOCOL_INIT...<br>
						VERIFYING HANDSHAKE...<br>
						ACCESS_TOKEN: [NULL]<br>
						WAITING FOR CREDENTIALS...<br>
						FIREBASE_AUTH: READY<br>
						SECURE_PIPE: ESTABLISHED<br>
						0011010010110...
					</div>
				</div>
			</div>

			<div class="access-panel">
				<div class="panel-header">
					<div class="panel-title">LOGIN</div>
					<div class="panel-sub">| AUTHENTICATE IDENTITY |</div>
				</div>

				<div class="auth-toggle">
					<div class="toggle-btn active" id="btn-login">LOGIN</div>
					<div class="toggle-btn" id="btn-signup">REGISTER</div>
				</div>

				<form id="login-form" onsubmit="event.preventDefault();">
					<div class="input-frame">
						<label>> SECURE EMAIL</label>
						<input type="email" class="tac-input" id="login-email" required>
					</div>
					<div class="input-frame">
						<label>> PASSWORD</label>
						<div class="password-wrapper">
							<input type="password" id="password" class="mh-input" placeholder="••••••" required>
							<i class="fas fa-eye password-toggle" onclick="togglePass('password', this)"></i>
						</div>
						<div style="text-align: right;">
							<a href="#" id="forgot-btn" class="forgot-link">FORGOT PASSWORD?</a>
						</div>
					</div>
					<button type="submit" class="execute-btn">ACCESS DASHBOARD</button>

					<div class="oauth-divider"><span>OR CONNECT WITH</span></div>
					<div class="oauth-grid">
						<button type="button" class="oauth-btn" id="google-btn" title="Google"><i class="fab fa-google"></i></button>
						<button type="button" class="oauth-btn" id="twitter-btn" title="Twitter"><i class="fab fa-twitter"></i></button>
						<button type="button" class="oauth-btn" id="github-btn" title="GitHub"><i class="fab fa-github"></i></button>
					</div>
				</form>

				<form id="register-form" onsubmit="event.preventDefault();" class="hidden">
					<div class="input-frame">
						<label>> FULL NAME</label>
						<input type="text" class="tac-input" id="reg-name" required>
					</div>
					<div class="input-frame">
						<label>> EMAIL ADDRESS</label>
						<input type="email" class="tac-input" id="reg-email" required>
					</div>
					
					<div class="input-frame">
						<label>> DESIGNATION</label>
						<div class="role-grid">
							<div class="role-card selected" data-role="client">
								<div class="role-icon"><i class="fas fa-user-graduate"></i></div>
								<div class="role-label">STUDENT</div>
							</div>
							<div class="role-card" data-role="freelancer">
								<div class="role-icon"><i class="fas fa-terminal"></i></div>
								<div class="role-label">FREELANCER</div>
							</div>
						</div>
						<input type="hidden" id="reg-role" value="client">
					</div>

					<label>> CREATE SECURITY CODE</label>
					<div class="password-wrapper">
						<input type="password" id="reg-password" class="mh-input" placeholder="••••••" required>
						<i class="fas fa-eye password-toggle" onclick="togglePass('reg-password', this)"></i>
					</div>

					<button type="submit" class="execute-btn" style="border-color:var(--mh-blue); color:var(--mh-blue);">INITIALIZE PROFILE</button>
				</form>

				<div class="status-log" id="status-display"></div>
				
				<a href="index.html" class="home-link">
					<i class="fas fa-undo"></i> ABORT OPERATION
				</a>
			</div>
		</div>
	</div>

		<script src="assets/js/jquery.min.js"></script>
		
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

		<script>
			$(document).ready(function() {
				console.log("MH CORE: UI Initialized.");

				// --- A. TAB SWITCHING (Login vs Signup) ---
				$('#btn-login').on('click', function() {
					$(this).addClass('active'); $('#btn-signup').removeClass('active');
					$('.login-container').removeClass('hidden'); 
					$('#login-form').removeClass('hidden'); $('#register-form').addClass('hidden');
					$('.panel-title').text("LOGIN");
				});

				$('#btn-signup').on('click', function() {
					$(this).addClass('active'); $('#btn-login').removeClass('active');
					$('.login-container').removeClass('hidden'); 
					$('#register-form').removeClass('hidden'); $('#login-form').addClass('hidden');
					$('.panel-title').text("ENLIST");
				});

				// --- B. ROLE SELECTION ---
				$('.role-card').on('click', function() {
					$('.role-card').removeClass('selected');
					$(this).addClass('selected');
					$('#reg-role').val($(this).data('role'));
				});

				// --- C. THE SAFETY TIMER (CRITICAL FIX) ---
				setTimeout(function() {
					if ($('#page-loader').is(':visible')) {
						console.warn("Security Block Detected? Forcing Interface Open...");
						$('#page-loader').fadeOut(600);
						$('.login-container').css('display', 'flex').hide().fadeIn(800);
					}
				}, 2500);
			});
		</script>

		<script type="module">
			// A. IMPORTS
			import { auth, db, dbID } from './assets/js/firebase-init.js';
			import { 
				signInWithEmailAndPassword, 
				createUserWithEmailAndPassword, 
				GoogleAuthProvider,
				signInWithPopup,
				signOut 
			} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
			import { doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

			// B. UI STATUS FUNCTION
			function typeStatus(text, color) {
				const statusBox = $('#status-display, #auth-status').first();
				if(statusBox.length) {
					statusBox.text(text).css('color', color || '#fff').fadeIn();
				} else {
					console.log("MH-LOG:", text);
				}
			}

			// C. CONNECTION SUCCESS REVEALER
			$(document).ready(() => {
				console.log("MH CLOUD: CONNECTION ESTABLISHED.");
				$('#page-loader').fadeOut(600); 
				$('.login-container').css('display', 'flex').hide().delay(300).fadeIn(800);
			});

			// D. LOGIN HANDLER
			$('#login-form').on('submit', async (e) => {
				e.preventDefault();
				const email = $('#login-email').val();
				const pass = $('#login-pass').val();
				
				typeStatus("> VERIFYING CREDENTIALS...", "#fff");

				try {
					const cred = await signInWithEmailAndPassword(auth, email, pass);
					const userRef = doc(db, 'artifacts', dbID, 'users', cred.user.uid);
					const docSnap = await getDoc(userRef);

					if (docSnap.exists()) {
						const role = docSnap.data().role;
						if (role === 'banned') {
							typeStatus("> ERROR: ACCESS REVOKED.", "#ff004c");
							await signOut(auth);
							return;
						}
						typeStatus(`> WELCOME, ${role.toUpperCase()}.`, "#00ff41");
						setTimeout(() => {
							window.location.href = (role === 'admin') ? 'Admin_Room.html' : 'index.html';
						}, 1000);
					} else {
						typeStatus("> ERROR: NO PROFILE DATA.", "#ff004c");
					}
				} catch (error) {
					typeStatus("> ERROR: " + error.code.replace('auth/', '').toUpperCase(), "#ff004c");
				}
			});

			// E. REGISTER HANDLER
			$('#register-form').on('submit', async (e) => {
				e.preventDefault();
				const name = $('#reg-name').val();
				const email = $('#reg-email').val();
				const pass = $('#reg-pass').val();
				const role = $('#reg-role').val();

				typeStatus("> ENCRYPTING DATA...", "#fff");

				try {
					const cred = await createUserWithEmailAndPassword(auth, email, pass);
					await setDoc(doc(db, 'artifacts', dbID, 'users', cred.user.uid), {
						name: name,
						email: email,
						role: role,
						joined: new Date().toISOString(),
						status: 'active'
					});

					typeStatus("> ID CREATED. REDIRECTING...", "#00ff41");
					setTimeout(() => {
						if (role === 'student') window.location.href = 'Student_Room.html';
						else if (role === 'freelancer') window.location.href = 'Freelancers_Room.html';
						else window.location.href = 'index.html';
					}, 1500);

				} catch (error) {
					console.error(error);
					typeStatus("> ERROR: " + error.code, "#ff004c");
				}
			});

			// F. GOOGLE LOGIN
			$('#google-btn').on('click', async () => {
				const provider = new GoogleAuthProvider();
				try {
					const result = await signInWithPopup(auth, provider);
					const userRef = doc(db, 'artifacts', dbID, 'users', result.user.uid);
					const docSnap = await getDoc(userRef);

					if (!docSnap.exists()) {
						await setDoc(userRef, {
							name: result.user.displayName,
							email: result.user.email,
							role: 'student', 
							joined: new Date().toISOString(),
							status: 'active'
						});
					}
					window.location.href = 'Student_Room.html';
				} catch (error) {
					console.error(error);
					typeStatus("> GOOGLE LINK FAILED.", "#ff004c");
				}
			});
			
			// --- THE ROUTER ---
			const routeUser = async (user) => {
				console.log("> ROUTING IDENTITY: " + user.uid);
				
				// Check if user exists in our Database
				const userRef = doc(db, 'artifacts', DB_ID, COLL_USERS, user.uid);
				const userSnap = await getDoc(userRef);

				if (userSnap.exists()) {
					// VETERAN USER -> Check Rank and Redirect
					const data = userSnap.data();
					const role = data.role;
					console.log("> RANK CONFIRMED: " + role);

					if (role === 'admin') window.location.href = "Admin_Room.html";
					else if (role === 'freelancer') window.location.href = "Freelancers_Room.html";
					else window.location.href = "Student_Room.html"; // Default for students
				} else {
					// NEW RECRUIT -> Create File
					console.log("> NEW RECRUIT. ASSIGNING RANK: STUDENT...");
					
					await setDoc(userRef, {
						uid: user.uid,
						email: user.email,
						displayName: user.displayName || "Unknown Operative",
						role: "student", // DEFAULT RANK
						wallet_balance: 0.00,
						joinedAt: serverTimestamp(),
						is_banned: false
					});

					window.location.href = "Student_Room.html";
				}
			};
		</script>
		
		<script>
			// 1. PASSWORD EYE TOGGLE
			function togglePass(id, icon) {
				console.log("Toggle activated for:", id); // Debug check
				const input = document.getElementById(id);
				
				if (input.type === "password") {
					input.type = "text";
					icon.classList.remove('fa-eye');
					icon.classList.add('fa-eye-slash');
					icon.style.color = "#00e5ff"; // Visual feedback
				} else {
					input.type = "password";
					icon.classList.remove('fa-eye-slash');
					icon.classList.add('fa-eye');
					icon.style.color = ""; // Reset color
				}
			}

			// 2. SWITCH TABS (LOGIN / REGISTER)
			function switchMode(mode) {
				if(mode === 'register') {
					document.getElementById('login-section').style.display = 'none';
					document.getElementById('register-section').style.display = 'block';
					updateStatus("> INITIATING RECRUITMENT PROTOCOL...", "#FFD700");
				} else {
					document.getElementById('register-section').style.display = 'none';
					document.getElementById('login-section').style.display = 'block';
					updateStatus("> RETURNING TO SECURE LOGIN...", "#00e5ff");
				}
			}

			// Helper for the Status Text
			function updateStatus(text, color) {
				const errBox = document.getElementById('login-error');
				if(errBox) {
					errBox.style.display = 'block';
					errBox.style.color = color || "#00e5ff";
					errBox.style.borderColor = color || "#00e5ff";
					errBox.innerText = text;
				}
			}
		</script>
		
		<script type="module">
			// 1. IMPORT FIREBASE ARSENAL
			import { auth, db, dbID } from './assets/js/firebase-init.js';
			import { 
				signInWithEmailAndPassword, 
				createUserWithEmailAndPassword,
				GoogleAuthProvider, 
				signInWithPopup,
				updateProfile
			} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
			import { doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
			import { attachHoverSounds } from './assets/js/sound-engine.js';

			// 2. UI UTILITIES (Eye Toggle & Form Switcher)
			window.togglePass = (id, icon) => {
				const input = document.getElementById(id);
				if (input.type === "password") {
					input.type = "text";
					icon.classList.remove('fa-eye');
					icon.classList.add('fa-eye-slash');
				} else {
					input.type = "password";
					icon.classList.remove('fa-eye-slash');
					icon.classList.add('fa-eye');
				}
			};

			window.switchMode = (mode) => {
				if(mode === 'register') {
					document.getElementById('login-section').style.display = 'none';
					document.getElementById('register-section').style.display = 'block';
					typeStatus("> INITIATING RECRUITMENT PROTOCOL...", "#FFD700");
				} else {
					document.getElementById('register-section').style.display = 'none';
					document.getElementById('login-section').style.display = 'block';
					typeStatus("> RETURNING TO SECURE LOGIN...", "#00e5ff");
				}
			};

			function typeStatus(text, color = "#00e5ff") {
				const errBox = document.getElementById('login-error');
				if(errBox) {
					errBox.style.display = 'block';
					errBox.style.color = color;
					errBox.style.borderColor = color;
					errBox.innerText = text;
				}
				console.log(`[SYSTEM]: ${text}`);
			}

			// 3. THE "GOD MODE" ROUTER
			async function routeUser(user) {
				typeStatus("> VERIFYING BIOMETRICS...", "#FFD700");
				
				try {
					const userRef = doc(db, 'artifacts', dbID, 'users', user.uid);
					const userSnap = await getDoc(userRef);

					// --- GOD MODE ACTIVATION ---
					// If this is YOU, force the rank to ADMIN immediately.
					if (user.email === "mhjerjawi836@gmail.com") {
						typeStatus("> COMMANDER RECOGNIZED. OVERRIDING PROTOCOLS...", "#ff004c");
						
						await setDoc(userRef, {
							name: "COMMANDER",
							email: user.email,
							role: 'admin', // <--- FORCE ADMIN
							rank: 'GENERAL',
							lastLogin: serverTimestamp(),
							isOnline: true
						}, { merge: true });

						setTimeout(() => window.location.href = 'Admin_Room.html', 1000);
						return;
					}
					// ---------------------------

					if (userSnap.exists()) {
						// EXISTING USER
						const data = userSnap.data();
						const role = data.role || 'student';
						typeStatus(`> CLEARANCE LEVEL: ${role.toUpperCase()}`, "#00ff41");

						// Route based on role
						if(role === 'admin') window.location.href = 'Admin_Room.html';
						else if(role === 'freelancer') window.location.href = 'Freelancers_Room.html';
						else window.location.href = 'Student_Room.html';

					} else {
						// NEW USER (Google Login or Register) -> DEFAULT TO STUDENT
						typeStatus("> NEW SIGNAL. REGISTERING...", "#0080FF");
						await setDoc(userRef, {
							name: user.displayName || user.email.split('@')[0],
							email: user.email,
							role: 'student',
							createdAt: serverTimestamp(),
							balance: 0,
							xp: 0
						});
						window.location.href = 'Student_Room.html';
					}

				} catch (err) {
					console.error("ROUTING ERROR:", err);
					typeStatus("> DATABASE ERROR: " + err.message, "#ff004c");
				}
			}

			// 4. EVENT LISTENERS
			document.addEventListener('DOMContentLoaded', () => {
				
				// A. LOGIN FORM SUBMIT
				const loginForm = document.getElementById('login-form');
				if(loginForm) {
					loginForm.addEventListener('submit', async (e) => {
						e.preventDefault();
						const email = document.getElementById('email').value;
						const pass = document.getElementById('password').value;
						typeStatus("> AUTHENTICATING...");
						try {
							const cred = await signInWithEmailAndPassword(auth, email, pass);
							await routeUser(cred.user);
						} catch (err) {
							typeStatus("> ACCESS DENIED: " + err.code, "#ff004c");
						}
					});
				}

				// B. REGISTER FORM SUBMIT
				const regForm = document.getElementById('register-form');
				if(regForm) {
					regForm.addEventListener('submit', async (e) => {
						e.preventDefault();
						const name = document.getElementById('reg-name').value;
						const email = document.getElementById('reg-email').value;
						const pass = document.getElementById('reg-password').value;
						
						typeStatus("> CREATING NEW IDENTITY...");
						try {
							const cred = await createUserWithEmailAndPassword(auth, email, pass);
							// Update Auth Profile
							await updateProfile(cred.user, { displayName: name });
							// Route (which creates DB entry)
							await routeUser(cred.user);
						} catch (err) {
							typeStatus("> REGISTRATION FAILED: " + err.message, "#ff004c");
						}
					});
				}

				// C. GOOGLE BUTTONS (BOTH LOGIN & REGISTER)
				const handleGoogle = async () => {
					const provider = new GoogleAuthProvider();
					typeStatus("> CONTACTING GOOGLE...", "#FFD700");
					try {
						const result = await signInWithPopup(auth, provider);
						await routeUser(result.user);
					} catch (err) {
						console.error(err);
						typeStatus("> GOOGLE LINK FAILED: " + err.code, "#ff004c");
					}
				};

				// Attach to Login Google Button
				const btnGoogleLogin = document.getElementById('btn-google-login');
				if(btnGoogleLogin) btnGoogleLogin.addEventListener('click', handleGoogle);

				// Attach to Register Google Button (if you added it)
				const btnGoogleReg = document.getElementById('btn-google-reg');
				if(btnGoogleReg) btnGoogleReg.addEventListener('click', handleGoogle);

				// Init Sounds
				try { attachHoverSounds('.btn-login, .mh-input, .btn-google'); } catch(e) {}
			});
		</script>
	</body>
</html>