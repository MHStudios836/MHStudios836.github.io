<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>MH Studios™ | Mission Briefing</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/fontawesome-all.min.css" />
		<link rel="icon" type="image/x-icon" href="images/Logo_1.png">
		
		<style>
			/* ==========================================================================
			   THEME: DOSSIER (PAPER / TECH HYBRID)
			   ========================================================================== */
			:root {
				--mh-orange: #ffae00;
				--mh-dark: #05070a;
				--mh-panel: #111;
				--mh-text: #e0e0e0;
				--mh-blue: #0080FF;
				--mh-cyan: #00e5ff;
			}

			body {
				background-color: #000;
				background-image: repeating-linear-gradient(45deg, #111 25%, transparent 25%, transparent 75%, #111 75%, #111), repeating-linear-gradient(45deg, #111 25%, #000 25%, #000 75%, #111 75%, #111);
				background-position: 0 0, 10px 10px;
				background-size: 20px 20px;
				color: var(--mh-text);
				font-family: 'Uni Sans', sans-serif;
				margin: 0;
			}

			/* --- 1. NAVIGATION (STICKY HUD) --- */
			#tactical-nav {
				position: fixed; top: 0; left: 0; width: 100%;
				padding: 15px 30px;
				z-index: 999;
				display: flex; justify-content: space-between; align-items: center;
				background: rgba(5, 7, 10, 0.95);
				backdrop-filter: blur(15px);
				border-bottom: 1px solid rgba(255,255,255,0.1);
			}
			.brand-link {
				display: flex; align-items: center; gap: 15px;
				color: #fff; font-family: 'Uni Sans', sans-serif; font-weight: 400; letter-spacing: 2px; font-size: 1.2em;
			}
			.brand-link img { height: 35px; filter: drop-shadow(0 0 5px var(--mh-orange)); }

			.menu-trigger {
				color: #fff; font-family: 'Uni Sans', sans-serif; font-weight: 400; cursor: pointer;
				padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
				display: flex; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: 1px;
			}
			.menu-trigger:hover { background: var(--mh-orange); color: #000; }

			/* --- 2. MENU OVERLAY --- */
			#menu-overlay {
				position: fixed; top: 0; right: -100%; width: 400px; height: 100%;
				background: rgba(5, 7, 10, 0.98);
				border-left: 2px solid var(--mh-orange);
				z-index: 1000;
				padding: 40px;
				display: flex; flex-direction: column;
				transition: 0.4s;
			}
			#menu-overlay.active { right: 0; }
			
			.menu-close { align-self: flex-end; font-size: 1.5em; color: #666; cursor: pointer; margin-bottom: 20px; }
			.menu-close:hover { color: var(--mh-red); }

			.menu-links a {
				display: block; font-size: 1.1em; color: #fff; padding: 12px 0;
				border-bottom: 1px solid rgba(255,255,255,0.05); text-transform: uppercase; letter-spacing: 2px; cursor: pointer; text-decoration: none;
			}
			.menu-links a:hover { color: var(--mh-orange); padding-left: 10px; border-bottom-color: var(--mh-orange); }

			.menu-section-title {
				color: #666; font-size: 0.7em; margin-top: 20px; margin-bottom: 10px; letter-spacing: 2px; border-bottom: 1px solid #333; padding-bottom: 5px;
			}

			/* LANGUAGE MATRIX */
			.lang-grid {
				display: flex; justify-content: center; gap: 15px; margin-top: auto; padding-top: 30px; border-top: 1px solid rgba(255,255,255,0.1);
			}
			.lang-btn {
				width: 40px; height: 30px; opacity: 0.4; transition: 0.3s; border: 1px solid transparent; border-radius: 4px; padding: 2px;
			}
			.lang-btn img { width: 100%; height: auto; display: block; }
			.lang-btn:hover, .lang-btn.active { opacity: 1; border-color: var(--mh-orange); transform: scale(1.1); }

			/* --- 3. DOSSIER CONTAINER --- */
			.dossier-container {
				max-width: 900px;
				margin: 140px auto 100px; /* Pushed down for header */
				background: #0d0d0d;
				border: 1px solid #333;
				box-shadow: 0 0 100px rgba(0,0,0,0.9);
				position: relative;
				padding: 0;
			}

			/* TOP SECRET STAMP */
			.stamp-top-secret {
				position: absolute; top: 40px; right: 40px;
				border: 5px solid rgba(255, 0, 0, 0.4);
				color: rgba(255, 0, 0, 0.4);
				font-size: 2em; font-weight: 900; padding: 10px 20px;
				transform: rotate(-15deg); letter-spacing: 5px;
				pointer-events: none; z-index: 0;
			}

			/* DOSSIER CONTENT */
			.dossier-header {
				background: #1a1a1a;
				padding: 30px 40px;
				border-bottom: 2px solid var(--mh-orange);
				display: flex; justify-content: space-between; align-items: center;
			}
			.dh-title { font-size: 1.5em; color: #fff; font-weight: bold; letter-spacing: 2px; }
			.dh-id { font-family: 'Courier New'; color: var(--mh-orange); }

			.dossier-body { padding: 40px; position: relative; z-index: 1; }
			.intel-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 40px; }
			
			.intel-block label { display: block; color: #666; font-size: 0.8em; margin-bottom: 5px; letter-spacing: 1px; }
			.intel-block .data { 
				font-size: 1.2em; color: #fff; border-bottom: 1px solid #333; padding-bottom: 10px; font-family: 'Courier New', monospace;
			}

			.mission-desc-box {
				background: rgba(0,0,0,0.3); border: 1px dashed #444; padding: 20px; margin-bottom: 40px;
				font-family: 'Courier New', monospace; color: #aaa; line-height: 1.6;
			}

			.terms-section {
				background: rgba(255, 174, 0, 0.05); padding: 20px; border-left: 3px solid var(--mh-orange);
				font-size: 0.9em; color: #888; margin-bottom: 30px;
			}
			.terms-section ul { margin: 10px 0 0 20px; }

			.signature-block { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; }
			.checkbox-custom { width: 20px; height: 20px; cursor: pointer; accent-color: var(--mh-orange); }

			.accept-btn {
				width: 100%; background: var(--mh-orange); color: #000; border: none; padding: 20px;
				font-size: 1.2em; font-weight: 900; letter-spacing: 2px; cursor: pointer; text-transform: uppercase;
				transition: 0.3s; opacity: 0.5; pointer-events: none;
			}
			.accept-btn.active { opacity: 1; pointer-events: all; }
			.accept-btn:hover { background: #fff; box-shadow: 0 0 30px var(--mh-orange); }

			.abort-link {
				display: block; text-align: center; margin-top: 20px; color: #555; font-size: 0.8em; text-decoration: none;
			}
			.abort-link:hover { color: #fff; }

			/* --- 4. FOOTER --- */
			#tactical-footer {
				padding: 60px 20px; background: #020202; border-top: 1px solid #111;
				font-size: 0.9em; color: #666; margin-top: 0;
			}
			.footer-grid {
				display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				max-width: 1200px; margin: 0 auto; gap: 40px;
			}
			.footer-col h4 { color: #fff; margin-bottom: 20px; border-left: 3px solid var(--mh-orange); padding-left: 10px; }
			.footer-col ul { list-style: none; padding: 0; }
			.footer-col a { color: #666; text-decoration: none; }
			.footer-col a:hover { color: var(--mh-orange); }

			@media (max-width: 700px) { .intel-grid { grid-template-columns: 1fr; gap: 20px; } #menu-overlay { width: 100%; } }
		</style>
	</head>
	<body>

		<nav id="tactical-nav">
			<a href="index.html" class="brand-link">
				<img src="images/Logo_1.png" alt="MH LOGO">
				MISSION INTEL
			</a>
			
			<div class="menu-trigger" id="menu-btn">
				<span>MENU</span>
				<i class="fas fa-bars"></i>
			</div>
		</nav>

		<div id="menu-overlay">
			<div class="menu-close"><i class="fas fa-times"></i></div>
			
			<div class="menu-section-title">FIELD COMMAND</div>
			<div class="menu-links">
				<a href="Freelancers_Room.html"><i class="fas fa-globe-americas"></i> JOB BOARD</a>
				<a href="Freelancers_Room.html"><i class="fas fa-briefcase"></i> MY MISSIONS</a>
			</div>

			<div class="menu-section-title">GLOBAL</div>
			<div class="menu-links">
				<a href="index.html"><i class="fas fa-home"></i> HOME BASE</a>
				<a href="Products_Services_Room.html"><i class="fas fa-cube"></i> THE ARMORY</a>
			</div>
			
			<div style="margin-top:30px; text-align:center;">
				<button id="btn-logout" class="accept-btn active" style="background:var(--mh-red); color:#fff; padding:10px;">ABORT SESSION</button>
			</div>

			<div class="lang-grid">
				<a href="#" class="lang-btn active" title="English"><img src="images/GB.png" alt="GB"></a>
				<a href="#" class="lang-btn" title="Arabic"><img src="images/Ar.png" alt="AR"></a>
				<a href="#" class="lang-btn" title="Dutch"><img src="images/Du.png" alt="NL"></a>
				<a href="#" class="lang-btn" title="Russian"><img src="images/Ru.png" alt="RU"></a>
			</div>
		</div>

		<div class="dossier-container">
			<div class="stamp-top-secret">CONFIDENTIAL</div>
			
			<div class="dossier-header">
				<div class="dh-title">MISSION DOSSIER</div>
				<div class="dh-id" id="mission-id">ID: LOADING...</div>
			</div>

			<div class="dossier-body">
				
				<div class="intel-grid">
					<div class="intel-block">
						<label>OPERATION TITLE</label>
						<div class="data" id="m-title">---</div>
					</div>
					<div class="intel-block">
						<label>BOUNTY (PAYMENT)</label>
						<div class="data" id="m-budget" style="color:var(--mh-orange);">---</div>
					</div>
					<div class="intel-block">
						<label>CLIENT (REQUESTER)</label>
						<div class="data" id="m-client">---</div>
					</div>
					<div class="intel-block">
						<label>DEADLINE</label>
						<div class="data" id="m-deadline" style="color:#ff004c;">---</div>
					</div>
				</div>

				<label style="color:#666; font-size:0.8em; margin-bottom:10px; display:block;">INTEL BRIEFING / DESCRIPTION</label>
				<div class="mission-desc-box" id="m-desc">
					Loading encrypted data...
				</div>

				<div class="terms-section">
					<strong>TERMS OF ENGAGEMENT:</strong>
					<ul>
						<li>I confirm I have the necessary skills to complete this mission.</li>
						<li>I agree to deliver the assets before the deadline.</li>
						<li>I understand that failure to deliver may result in a rank demotion.</li>
					</ul>
				</div>

				<div class="signature-block">
					<input type="checkbox" id="agree-check" class="checkbox-custom">
					<label for="agree-check" style="color:#fff; cursor:pointer;">I HAVE READ AND ACCEPT THE TERMS OF THIS CONTRACT.</label>
				</div>

				<button id="btn-accept" class="accept-btn">SIGN & SECURE CONTRACT</button>

				<a href="Freelancers_Room.html" class="abort-link">// ABORT & RETURN TO JOB BOARD</a>
			</div>
		</div>

		<footer id="tactical-footer">
			<div class="footer-grid">
				<div class="footer-col">
					<h4>MH STUDIOS™</h4>
					<p>&copy; 2025 ALL RIGHTS RESERVED.</p>
				</div>
				<div class="footer-col">
					<h4>SECTORS</h4>
					<ul>
						<li><a href="Products_Services_Room.html">The Armory</a></li>
						<li><a href="Packages.html">Packages</a></li>
						<li><a href="index.html#guild-sector">The Guild</a></li>
					</ul>
				</div>
				<div class="footer-col">
					<h4>SECURE CHANNELS</h4>
					<div style="font-size:1.5em; display:flex; gap:15px;">
						<a href="#"><i class="fab fa-discord"></i></a>
						<a href="#"><i class="fab fa-github"></i></a>
						<a href="#"><i class="fab fa-linkedin"></i></a>
						<a href="#"><i class="fab fa-instagram"></i></a>
					</div>
				</div>
			</div>
		</footer>

		<script src="assets/js/jquery.min.js"></script>
		<script>
			// UI LOGIC
			$(document).ready(function() {
				$('#menu-btn').click(() => $('#menu-overlay').addClass('active'));
				$('.menu-close').click(() => $('#menu-overlay').removeClass('active'));
				$('.lang-btn').click(function(e) { e.preventDefault(); $('.lang-btn').removeClass('active'); $(this).addClass('active'); });
			});
		</script>
		<script type="module">
			import { auth, db, appId } from './assets/js/firebase-init.js';
			import { onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js';
			import { doc, getDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js';

			let currentUser = null;
			const params = new URLSearchParams(window.location.search);
			const missionId = params.get('id');

			// AUTH CHECK
			onAuthStateChanged(auth, (user) => {
				if (user) {
					currentUser = user;
					loadMissionData();
				} else {
					window.location.href = 'DoD_Login_Style.html';
				}
			});

			// LOGOUT
			$('#btn-logout').click(async () => {
				if(confirm("ABORT SESSION?")) {
					await signOut(auth);
					window.location.href = 'DoD_Login_Style.html';
				}
			});

			// LOAD DATA
			async function loadMissionData() {
				if(!missionId) { alert("ERR: NO MISSION ID"); window.location.href = 'Freelancers_Room.html'; return; }

				try {
					const docRef = doc(db, 'artifacts', appId, 'missions', missionId);
					const docSnap = await getDoc(docRef);

					if (docSnap.exists()) {
						const m = docSnap.data();
						
						if(m.status !== 'OPEN') {
							alert("MISSION ALREADY ASSIGNED. RETURNING TO BASE.");
							window.location.href = 'Freelancers_Room.html';
						}

						$('#mission-id').text('ID: ' + missionId.substr(0,8).toUpperCase());
						$('#m-title').text(m.title);
						$('#m-budget').text('$' + m.budget);
						$('#m-client').text(m.ownerName || 'Unknown Agent');
						$('#m-deadline').text(m.deadline);
						$('#m-desc').text(m.description);

					} else {
						alert("INTEL NOT FOUND.");
						window.location.href = 'Freelancers_Room.html';
					}
				} catch (e) {
					console.error("Intel Error:", e);
				}
			}

			// ENABLE SIGNATURE
			$('#agree-check').change(function() {
				if(this.checked) {
					$('#btn-accept').addClass('active').text("SECURE CONTRACT (EXECUTE)");
				} else {
					$('#btn-accept').removeClass('active').text("SIGN & SECURE CONTRACT");
				}
			});

			// EXECUTE CONTRACT
			$('#btn-accept').click(async () => {
				if(!$('#agree-check').is(':checked')) return;

				const btn = $('#btn-accept');
				btn.text("ENCRYPTING SIGNATURE...").css('background', '#fff').css('color', '#000');

				try {
					const userDoc = await getDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid));
					const freelancerName = userDoc.exists() ? userDoc.data().name : "Unknown Operative";

					await updateDoc(doc(db, 'artifacts', appId, 'missions', missionId), {
						status: 'ASSIGNED',
						freelancerId: currentUser.uid,
						freelancerName: freelancerName
					});

					alert("CONTRACT SECURED.\nMission status updated to IN PROGRESS.");
					window.location.href = 'Freelancers_Room.html';

				} catch (e) {
					console.error("Sign Error:", e);
					alert("CONTRACT FAILED: " + e.message);
					btn.text("TRY AGAIN").css('background', 'red');
				}
			});
		</script>

	</body>
</html>