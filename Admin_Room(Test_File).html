<!DOCTYPE HTML>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>MH Studios™ - Admin / User Homepage</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/fontawesome-all.min.css" />
		<!-- NEW: Include specialized search bar CSS -->
        <link rel="stylesheet" href="assets/css/Search_Bar.css">
		<script src="https://kit.fontawesome.com/c4445c7fdf.js" crossorigin="anonymous"></script>
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="images/Logo_1.png">
		
<style>
			
			/* Styling for the hidden admin panel inside the wrapper */
			#admin-panel.hidden {
				display: none;
			}
			/* Styling for Access Denied Card */
			#access-denied-card {
				display: none;
				padding: 30px;
				border: 1px solid #FF4500;
				background-color: #242943;
				margin-top: 50px;
				color: #E0E0E0;
				text-align: center;
			}
		</style>
		
		</head>
		<body class="is-preload">
		
			<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
			<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
			
			<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
			<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>

        // ... (Your existing security script is here) ...
		
			<script>
			// 1. Firebase Initialization
			const firebaseConfig = {
			  apiKey: "AIzaSyATOnkG8yomjUFdKnNiPPJO24z0tF6e5wo",
			  authDomain: "mhstudios-836.firebaseapp.com",
			  projectId: "mhstudios-836", 
			  storageBucket: "mhstudios-836.firebasestorage.app",
			  messagingSenderId: "172610798643",
			  appId: "1:172610798643:web:eaa7b218e8efa3aee64f46",
			  measurementId: "G-6EMB5KYCTK"
			};
			
			const app = firebase.initializeApp(firebaseConfig);
			const auth = app.auth();

			// 2. Authentication and Authorization Check
			auth.onAuthStateChanged(function(user) {
				const protectedContent = document.getElementById('protected-content');
				const authMessage = document.getElementById('auth-message');
				const deniedCard = document.getElementById('access-denied-card');
				const adminPanel = document.getElementById('admin-panel');
				
				// Always start by hiding the message and showing the loading screen
				if (authMessage) authMessage.style.display = 'block';
				if (protectedContent) protectedContent.style.display = 'none';

				if (user) {
					// User is logged in, now check for the Admin role via Custom Claims
					user.getIdTokenResult()
						.then((idTokenResult) => {
							if (authMessage) authMessage.style.display = 'none'; // Hide loading message
							if (protectedContent) protectedContent.style.display = 'block'; // Show content wrapper
							
							// --- Handle Header UI Update (from admin.js logic) ---
							updateHeaderUI(user);
							
							if (idTokenResult.claims.admin === true) {
								// Access Granted: Show the Admin Panel
								if (adminPanel) adminPanel.classList.remove('hidden');
								if (deniedCard) deniedCard.style.display = 'none';
								
								// Update Admin Panel text
								document.getElementById('admin-user-id').textContent = user.uid;
								document.getElementById('admin-role-status').textContent = 'ADMINISTRATOR';
								document.getElementById('admin-user-name').textContent = user.displayName || 'Admin';

							} else {
								// Logged in but NOT Admin: Show denial message
								if (adminPanel) adminPanel.classList.add('hidden');
								if (deniedCard) deniedCard.style.display = 'block';
							}
						})
						.catch((error) => {
							console.error("Error checking role:", error);
							window.location.href = "DoD_Login_Style.html?error=auth";
						});
				} else {
					// No user logged in: Redirect to login page
					window.location.href = "DoD_Login_Style.html?redirect=unauthorized"; 
				}
			});

			/**
			 * Handles the dynamic Sign In/Sign Out button switch. 
			 * This logic is necessary here because the state is known.
			 */
			function updateHeaderUI(user) {
				const authLinkContainer = document.getElementById('auth-link-container');
				const signoutLinkContainer = document.getElementById('signout-link-container');
				const authLink = document.getElementById('auth-link');
				
				if (authLink && authLinkContainer && signoutLinkContainer) {
					if (user) {
						const userName = user.displayName || user.email;
						authLink.setAttribute('href', '#'); 
						authLink.innerHTML = `<i class="fas fa-user-shield"></i> <span id="auth-text">${userName}</span>`; 
						signoutLinkContainer.style.display = 'list-item'; 
						authLinkContainer.style.display = 'none';
					} else {
						authLink.setAttribute('href', 'DoD_Login_Style.html');
						authLink.innerHTML = `<i class="fas fa-sign-in-alt"></i> <span id="auth-text">Sign In</span>`;
						signoutLinkContainer.style.display = 'none';
						authLinkContainer.style.display = 'list-item'; 
					}
				}
			}

			// Attach sign out event listener
			document.addEventListener('DOMContentLoaded', () => {
				const signoutLink = document.getElementById('signout-link');
				if (signoutLink) {
					signoutLink.addEventListener('click', (e) => {
						e.preventDefault();
						auth.signOut().then(() => {
							window.location.href = "DoD_Login_Style.html";
						}).catch((error) => {
							console.error("Logout Error:", error);
						});
					});
				}
			});

			// 3. Initialization call for the UI logic in admin.js
			// This function must be defined in admin.js and only contain UI logic (tabs, forms).
			document.addEventListener('DOMContentLoaded', () => {
				if (typeof initAdminUILogic === 'function') {
					initAdminUILogic();
				}
			});
		</script>
				<div id="auth-message" style="
				text-align: center; 
				padding: 100px; 
				font-family: 'Uni Sans', sans-serif;
				color: #FFF; ">
				<h1>Checking Access...</h1>
				<p>Please wait a moment while we verify your credentials.</p>
			</div>
			
			<div id="protected-content" style="display: none;">
		
			<div id="wrapper">

				<!-- Header (Updated with ID for Firebase logic) -->
				<!-- Note: The "styleN" class below should match that of the banner element. -->
					<header id="header" class="alt style2">
						<a href="index.html" class="logo"><strong>MH</strong><span>STUDIOS™</span></a>
						<nav id="menu">
								<ul class="links">
									</ul>
								
								<ul class="actions stacked">
									<li id="auth-link-container" class="is-admin-link">
										<a href="DoD_Login_Style.html" id="auth-link" class="button primary fit">
											<i class="fas fa-sign-in-alt"></i> <span id="auth-text">Sign In</span>
										</a>
									</li>
									
									<li id="signout-link-container" style="display: none;" class="is-admin-link">
										<a href="#" id="signout-link" class="button fit">
											<i class="fas fa-sign-out-alt"></i> <span id="signout-text">Sign Out</span>
										</a>
									</li>

									<li><a href="Admin_Room.html" class="button fit">Admin Panel</a></li>
									</ul>
							</nav>						
							<!-- ICON TARGET (Hidden by default, shown when logged in) -->
							<a href="Admin_Room.html" id="user-icon-container" class="profile-pic" style="display: none;">
							<img id="user-status-icon" class="icon-signed-out" src="images/man.png" alt="User Profile" width="32" height="32">
							</a>
							<!-- NEW SEARCH FORM -->
                            <form id="header-search-form" method="get" action="#">
                            <input type="text" name="query" placeholder="Search..." required />
                            <button type="submit" aria-label="Search"><i class="fas fa-search"></i></button>
                            </form>
                            <!-- END NEW SEARCH FORM -->
							<a href="#menu">Menu</a>
						</nav>
					</header>

				<!-- Menu -->
					<nav id="menu">
						<ul class="links">
					        <li id="menu-user-status" class="user-status-item" style="display: none;">
							<div style="display:flex; align-items:center; gap: 10px; padding: 10px 0;">
							<img id="menu-profile-icon" src="images/man.png" alt="User Icon" width="32" height="32" style="border-radius: 50%;">
							<span id="menu-display-name" style="font-weight: 600;">Guest</span>
							</div>
							</li>
							<li><a href="index.html">Home</a></li>
							<li><a href="landing.html">About Us</a></li>
							<li><a href="DoD_Login_Style.html">Services</a></li>
							<li><a href="elements.html">Designs</a></li>
						</ul>
						<ul class="actions stacked">
						<li><a href="#" class="button primary fit" data-translate="menu.get_started">Get Started</a></li>
						
						<li><a href="DoD_Login_Style.html" class="button primary fit" data-translate="menu.login">Log In</a></li>
						
						<li><a href="Login_Signup.html" class="button fit" data-translate="menu.signup">Sign Up</a></li>
						
						<li class="lang-switch-container">
						<button class="lang-btn-flag active" id="lang-en"><img src="images/GB.png" class="img" alt="" width="16" height="16"> En</button>
						<button class="lang-btn-flag" id="lang-ar"><img src="images/Ar_1.png" class="img" alt="" width="16" height="16"> Ar</button>
						<button class="lang-btn-flag" id="lang-ru"><img src="images/ru.png" class="img" alt="" width="16" height="16"> Ru</button>
						<button class="lang-btn-flag" id="lang-du"><img src="images/du.png" class="img" alt="" width="16" height="16"> Du</button>
						</li>
					</ul>
					</nav>

				<!-- Banner -->
				<!-- Note: The "styleN" class below should match that of the header element. -->
					<section id="banner" class="style2">
						<div class="inner">
							<span class="image">
								<img src="images/Coding_5_Upscaled.jpeg" alt="" />
							</span>
							<header class="major">
							<img src="images/form.png" class="img-responsive/link logo-in-header" alt="" width="42" height="42"><h1>Dashboard</h1>
							</header>
							<div class="content">
								<p>You can edit your profile here, <br/>View Packages, Services, Dashboardsand more.</p>
							</div>
						</div>
					</section>

			<!-- Main Content Area -->
			<div id="main">
				<div class="inner">
					<h1>Admin Room</h1>
					<p>Welcome, **<span id="admin-user-name">Admin</span>**! This is your control center for managing MH Studios™ features.</p>

					<!-- Access Denied Card (Initially hidden) -->
					<div id="access-denied-card" class="admin-card">
						<h2><i class="fas fa-exclamation-triangle"></i> Access Denied</h2>
						<p>You do not have the necessary **Admin** privileges to view this page. If you believe this is an error, please purchase the <a href="Payment_Gateway.html">Admin Access Subscription</a>.</p>
						<ul class="actions">
							<li><a href="Payment_Gateway.html" class="button primary">Go to Payment Gateway</a></li>
							<li><a href="DoD_Login_Style.html" class="button">Log In / Sign Up</a></li>
						</ul>
					</div>

					<!-- Admin Panel (Initially hidden, shown only on success) -->
					<div id="admin-panel" class="hidden">
						
						<div class="admin-header">
							<i class="fas fa-shield-alt admin-status-icon"></i>
							<div class="admin-status">
								<h3>Status: <span style="color: #53e3fb;">Active Admin Access</span></h3>
								<p>User ID: <span id="admin-user-id">Loading...</span> | Role: <span id="admin-role-status">Loading...</span></p>
							</div>
						</div>
						
						<!-- Tab Navigation -->
						<ul class="tabs">
							<li><a href="#" data-tab="dashboard-tab" class="active"><i class="fas fa-chart-line"></i> Dashboard</a></li>
							<li><a href="#" data-tab="users-tab"><i class="fas fa-users"></i> User Management</a></li>
							<li><a href="#" data-tab="settings-tab"><i class="fas fa-cog"></i> Payment Settings</a></li>
						</ul>

						<!-- Dashboard Tab -->
						<div class="tab-content active" id="dashboard-tab">
							<div class="admin-card">
								<h2>System Overview</h2>
								<p>This section would display key metrics, such as total users, active subscriptions, and recent activity logs. The system is running optimally.</p>
								<ul class="actions">
									<li><a href="#" class="button small">Generate Report</a></li>
								</ul>
							</div>
						</div>

						<!-- User Management Tab -->
						<div class="tab-content" id="users-tab" style="display: none;">
							<div class="admin-card">
								<h2>Manage Users</h2>
								<p>List of all users and their current roles. Admins can revoke access or promote users here.</p>
								<!-- Placeholder for user list table/component -->
								<div style="border: 1px dashed #444; padding: 20px; text-align: center;">
									User List Table Placeholder (requires real-time Firestore listener)
								</div>
							</div>
						</div>

						<!-- Payment Settings Tab (Uses admin-ui.js logic) -->
						<div class="tab-content" id="settings-tab" style="display: none;">
							<div class="admin-card">
								<h2>Payment & Subscription Settings</h2>
								
								<p id="payment-success-message"></p>
								<p id="payment-error-message"></p>

								<form id="payment-update-form" method="post">
									<div class="fields">
										<div class="field">
											<label for="card-number-update">Update Card Number</label>
											<input type="text" name="card-number-update" id="card-number-update" placeholder="XXXX XXXX XXXX XXXX" required maxlength="16" pattern="\d{16}" />
										</div>
										<div class="field">
											<label for="expiry-date-update">Expiry Date (MM/YY)</label>
											<input type="text" name="expiry-date-update" id="expiry-date-update" placeholder="MM/YY" required maxlength="5" pattern="\d{2}/\d{2}" />
										</div>
										<div class="field">
											<label for="cvv-update">CVV</label>
											<input type="password" name="cvv-update" id="cvv-update" placeholder="XXX" required maxlength="3" pattern="\d{3}" />
										</div>
										<div class="field">
											<label for="zip-code-update">Billing Zip/Postal Code</label>
											<input type="text" name="zip-code-update" id="zip-code-update" required />
										</div>
									</div>
									<ul class="actions">
										<li><input type="submit" value="Update Payment Method" class="primary" /></li>
										<li><button type="button" id="cancel-subscription-button" class="button">Cancel Subscription</button></li>
									</ul>
								</form>
							</div>
						</div>

					</div>
				</div>
			</div>

				<!-- Contact -->
					<section id="contact">
						<div class="inner">
							<section>
								<form method="POST" action="https://formspree.io/f/myznzeae">
									<div class="fields">
										<div class="field half">
											<label for="name">Name</label>
											<input type="text" name="name" id="name" />
										</div>
										<div class="field half">
											<label for="email">Email</label>
											<input type="text" name="email" id="email" />
										</div>
										<div class="field">
											<label for="message">Message</label>
											<textarea name="message" id="message" rows="6"></textarea>
										</div>
									</div>
									<ul class="actions">
										<li><input type="submit" value="Send Message" class="primary" /></li>
										<li><input type="reset" value="Clear" /></li>
									</ul>
								</form>
							</section>
							<section class="split">
								<section>
									<div class="contact-method">
										<a href="mailto:MHStudios.836@gmail.com" class="icon solid alt fa-envelope"></a>
										<h3>Email</h3>
										<a href="mailto:MHStudios.836@gmail.com">MHStudios.836@gmail.com</a>
									</div>
								</section>
								<section>
									<div class="contact-method">
										<a href="https://wa.me/message/OOFIM5FC3SLMD1" class="icon solid alt fa-phone"></a>
										<h3>Phone</h3>
										<p><a href="tel:+962797852640">+962 7 9785 2640</a></p>
									</div>
								</section>
								<section>
									<div class="contact-method">
										<a href="https://maps.app.goo.gl/cQ4JX3wWHvy8C8Ro8" class="icon solid alt fa-home"></a>
										<h3>Address</h3>
										<p><a href="https://maps.app.goo.gl/cQ4JX3wWHvy8C8Ro8">Queen Rania St 134,<br />
										Amman,<br />
										Jordan</a>
									</div>
								</section>
							</section>
						</div>
					</section>

				<!-- Footer -->
					<footer id="footer">
						<div class="inner">
							<ul class="icons">
								<li><a href="https://www.x.com/MHStudios836" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
								<li><a href="https://www.facebook.com/mh.studios.836/" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
								<li><a href="https://www.instagram.com/mhdesigns.836" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
								<li><a href="https://github.com/MHStudios836" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
								<li><a href="https://www.linkedin.com/in/mhstudios836/" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
								<li><a href="https://www.youtube.com/@mh.studios.836" class="icon brands alt fa-youtube"><span class="label">YouTube</span></a></li>
								<li><a href="https://wa.me/message/OOFIM5FC3SLMD1" class="icon brands alt fa-whatsapp"><span class="label">WhatsApp</span></a></li>
							</ul>
							<ul class="copyright">
								<li>&copy;2025 MH STUDIOS™ - All Rights Reserved</li><li>Design: <a href="https://www.instagram.com/mhdesigns.836"><img src="images/Logo_2.png" class="icon" alt="MH Studios™" width="12" height="12"> MH Designs™</a></li>
							</ul>
						</div>
					</footer>

				</div>
			</div>
			<!-- Scripts --> 
			<script src="assets/js/jquery.min.js"></script>
			
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			
			<script src="assets/js/firebase-init.js"></script> 
			<script src="assets/js/admin.js"></script> 
			<script src="assets/js/language-switcher.js"></script>
			<script src="assets/js/Search_Box.js"></script>
			
	</body>
</html>